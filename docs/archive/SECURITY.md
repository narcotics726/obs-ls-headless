# Security Guidelines

## üîí Sensitive Information Protection

### Environment Variables

**NEVER commit these files:**
- `.env` - Contains actual credentials
- `.env.local` - Local overrides
- `.env.production` - Production credentials
- `.env.development` - Development credentials
- Any `*.env.backup` or `*.env.bak` files

**Safe to commit:**
- `.env.example` - Template with placeholder values only

### Credentials Checklist

Before committing, ensure:
- [ ] No hardcoded passwords in source code
- [ ] No API keys in source code
- [ ] No database credentials in source code
- [ ] All sensitive values use `process.env.*`
- [ ] `.env` file is in `.gitignore`
- [ ] `.env.example` contains only placeholder values

### Configuration

All sensitive configuration is loaded from environment variables:

```typescript
// ‚úÖ CORRECT - Using environment variables
const config = {
  couchdb: {
    url: process.env.COUCHDB_URL,
    username: process.env.COUCHDB_USERNAME,
    password: process.env.COUCHDB_PASSWORD,
    passphrase: process.env.COUCHDB_PASSPHRASE,
  }
};

// ‚ùå WRONG - Hardcoded credentials
const config = {
  couchdb: {
    password: "my-secret-password",  // NEVER DO THIS!
  }
};
```

## üîê Encryption

### Passphrase Security

The `COUCHDB_PASSPHRASE` is used for:
- Decrypting LiveSync's HKDF-encrypted chunks
- Must match your Obsidian LiveSync passphrase exactly

**Important:**
- Store passphrase in `.env` file (which is gitignored)
- Never commit the passphrase to version control
- Use strong, unique passphrases
- Rotate passphrases periodically

### PBKDF2 Salt

The PBKDF2 salt is:
- Automatically retrieved from `_local/obsidian_livesync_sync_parameters`
- Stored in CouchDB, not in code
- Generated by LiveSync plugin
- No need to manage manually

## üö® Security Best Practices

### 1. Environment Setup

```bash
# Copy example and edit with real values
cp .env.example .env

# Set restrictive permissions
chmod 600 .env

# Never commit .env
git status  # Verify .env is not listed
```

### 2. Production Deployment

- Use environment variables or secrets management (e.g., Docker secrets, Kubernetes secrets)
- Never store credentials in container images
- Use separate credentials for each environment
- Enable CouchDB authentication
- Use HTTPS for CouchDB connections

### 3. CouchDB Security

```env
# ‚úÖ GOOD - HTTPS with authentication
COUCHDB_URL=https://couchdb.example.com:6984
COUCHDB_USERNAME=secure_user
COUCHDB_PASSWORD=strong_random_password

# ‚ùå BAD - HTTP without auth
COUCHDB_URL=http://localhost:5984
```

### 4. API Security

Consider adding:
- API authentication (JWT, API keys)
- Rate limiting
- CORS configuration
- Request validation

## üîç Security Audit

Run these checks before committing:

```bash
# Check for hardcoded secrets
git diff | grep -E "(password|secret|api_key|passphrase)\s*[:=]\s*['\"]"

# Verify .env is ignored
git check-ignore .env

# Check what's being committed
git status
git diff --cached

# Search for potential secrets in tracked files
git ls-files | xargs grep -i "password\|secret\|api_key" | grep -v ".example"
```

## üìù Incident Response

If credentials are accidentally committed:

1. **Immediately rotate all exposed credentials**
2. **Remove from git history:**
   ```bash
   # Use git-filter-repo or BFG Repo-Cleaner
   git filter-repo --path .env --invert-paths
   ```
3. **Force push (if safe to do so):**
   ```bash
   git push --force
   ```
4. **Notify team members**
5. **Review access logs**

## üîó Related Documentation

- [CouchDB Security](https://docs.couchdb.org/en/stable/intro/security.html)
- [Obsidian LiveSync Security](https://github.com/vrtmrz/obsidian-livesync#security)
- [Node.js Security Best Practices](https://nodejs.org/en/docs/guides/security/)

## ‚úÖ Current Status

- ‚úÖ `.env` properly gitignored
- ‚úÖ No hardcoded credentials in source code
- ‚úÖ All sensitive values use environment variables
- ‚úÖ `.env.example` contains only placeholders
- ‚úÖ Encryption passphrase handled securely
